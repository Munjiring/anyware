<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="mailMapper">

<resultMap id="addressResult" type="AddressBook">
	<id column="add_no" property="addNo" />
	<result column="name" property="name" />
	<result column="dept_name" property="deptName" />
	<result column="job_name" property="jobName" />
	<result column="email" property="email" />
	<result column="phone" property="phone" />
	<result column="biz_name" property="bizName" />
	<result column="group_no" property="groupNo" />
	<result column="mem_no" property="memNo" />
	<result column="group_name" property="groupName" />


</resultMap>

<resultMap id="groupResult" type="AddressGroup">
	<id column="group_no" property="groupNo" />
	<result column="group_name" property="groupName" />
	<result column="member_no" property="memNo" />
	
</resultMap>




<!-- 개인주소록 조회 -->
<!-- 주소록 갯수 -->
<select id="selectAddressListCount" resultType="_int">
	select count(*)
	  from tb_addressbook
	 where status = 'Y'
	 and mem_no = #{memNo} 
</select>

<!--주소록 리스트 -->
<select id="selectAddbookList" resultMap="addressResult">
	select 
	        add_no
	       , name
	       , dept_name
	       , job_name
	       , email
	       , phone
	       , biz_name
	       , b.group_no
	       , group_name
	       , mem_no
	from tb_addressbook b
	join tb_addressgroup g on (b.group_no = g.group_no)
	where b.status = 'Y' 
	  and mem_no = #{memNo}  <!--로그인한 사원번호로 변경하기 -->
	 order by add_no desc

</select>

<!--로그인한 회원의 주소록 그룹리스트 -->
<select id="selectGroupList" resultMap="groupResult">
	select
		   group_no
		  ,group_name
      from tb_addressgroup
      where member_no = #{memNo}  <!--로그인한 사원번호로 변경하기 -->
      and status= 'Y' 
</select>

<!-- 그룹추가 -->
<insert id="insertAddressGroup">
	insert 
	  into tb_addressgroup
	  (
	    group_no
	  , group_name
	  , member_no
	  )
	  values
	  (
	  seq_gno.nextval
	  ,#{groupName}
	  ,#{memNo}
	  )

</insert>

<!-- 주소록추가 -->
<insert id="insertAddressBook">
	insert 
	  into tb_addressbook
	  (
	   add_no
	  , name
	  , dept_name
	  , job_name
	  , email
	  , phone
	  , biz_name
	  , group_no
	  , mem_no
	  )
	values
	(  
	  seq_abno.nextval
	 ,#{name}
	 ,#{deptName}
	 ,#{jobName}
	 ,#{email}
	 ,#{phone}
	 ,#{bizName}
	 ,#{groupNo}
	 ,#{memNo} 

	  )
	  

</insert>












































</mapper>
